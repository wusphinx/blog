<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>just for fun!</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content><meta name=generator content="Hugo 0.85.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/ananke/css/main.min.css><link href=/index.xml rel=alternate type=application/rss+xml title="just for fun!"><link href=/index.xml rel=feed type=application/rss+xml title="just for fun!"><meta property="og:title" content="just for fun!"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="http://example.org/"><meta itemprop=name content="just for fun!"><meta itemprop=description content><meta name=twitter:card content="summary"><meta name=twitter:title content="just for fun!"><meta name=twitter:description content></head><body class="ma0 avenir bg-near-white"><header><div class="pb3-m pb6-l bg-black"><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">just for fun!</a><div class="flex-l items-center"></div></div></nav><div class="tc-l pv3 ph3 ph4-ns"><h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">just for fun!</h1></div></div></header><main class=pb7 role=main><article class="cf ph3 ph5-l pv3 pv4-l f4 tc-l center measure-wide lh-copy mid-gray"></article><div class="pa3 pa4-ns w-100 w-70-ns center"><h1 class=flex-none>Recent Posts</h1><section class="w-100 mw8"><div class="relative w-100 mb4"><article class="bb b--black-10"><div class="db pv4 ph3 ph0-l no-underline dark-gray"><div class="flex flex-column flex-row-ns"><div class="blah w-100"><h1 class="f3 fw1 athelas mt0 lh-title"><a href=/posts/api%E7%BD%91%E5%85%B3%E4%B9%8Bkrakend/ class="color-inherit dim link">API网关之krakend</a></h1><div class="f6 f5-l lh-copy nested-copy-line-height nested-links">这一篇已经拖了好久了，以至于提笔开始写的时候，krakend项目已经改名为lura了，而且这个网关项目还进入到了CNCF中，真的是士别三日，当刮目相看了。不知不觉，我使用的这个开源项目作为团队的业务网关都已经上线了。
当初我为什么要选择这个网关呢？首先团队跟外部沟通的协议为HTTP，有一些鉴权需求，本身业务量并不大，需要支持自定义插件的，最好是用golang写的，便于维护。从功能上来讲，其实nginx非常符合我的需求，除了技术栈，我只用了几天时间调研试用，就迅速确定了krakend作为API网关的框架，使用简单，性能还很强的样子。当然，从业务量上来讲，性能不是第一优先级，我需要解决的是从无到有的问题。
我所在的团队属于初创，后端这部分有好几个人在写，功能上重复，每个人都跟自己的业务前端对接，部门所做的几个功能都挺分散的，再加上权限控制的需求愈发强烈，网关的必要性就凸显出来了。短短不到百行代码，就能创建一个API网关，这是我选择的主要原因。
package main import ( "flag" "log" "os" "github.com/luraproject/lura/config" "github.com/luraproject/lura/logging" "github.com/luraproject/lura/proxy" "github.com/luraproject/lura/router/gin" ) func main() { port := flag.Int("p", 0, "Port of the service") logLevel := flag.String("l", "ERROR", "Logging level") debug := flag.Bool("d", false, "Enable the debug") configFile := flag.String("c", "/etc/lura/lura.json", "Path to the configuration filename") flag.Parse() parser := config.NewParser() serviceConfig, err := parser.Parse(*configFile) if err != nil { log.Fatal("ERROR:", err.Error()) } serviceConfig.Debug = serviceConfig.Debug || *debug if *port !</div><a href=/posts/api%E7%BD%91%E5%85%B3%E4%B9%8Bkrakend/ class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a></div></div></div></article></div><div class="relative w-100 mb4"><article class="bb b--black-10"><div class="db pv4 ph3 ph0-l no-underline dark-gray"><div class="flex flex-column flex-row-ns"><div class="blah w-100"><h1 class="f3 fw1 athelas mt0 lh-title"><a href=/posts/api%E7%BD%91%E5%85%B3%E9%80%89%E5%9E%8B/ class="color-inherit dim link">API网关选型</a></h1><div class="f6 f5-l lh-copy nested-copy-line-height nested-links">来新公司第一个月，客户端部门做后端，我应该是这个部门里面最专业的后端了吧，嗯，不能这么讲，应该是在后端领域工龄最长的人，这样描述相对客观。在这里我得知现在团队当前后端Golang项目都是客户端开发的人做的，坦白说，代码规范不太好，我随便看了几个项目，几个问题比较突出：
代码未格式化，风格凌乱; 有的项目存在很多无用甚至是错误的测试用例，导致我用VSCode打开项目会看到不少错误; 有的项目代码仓库提交了一些不该提交的文件; 数据库表结构跟代码未同步，这直接导致我需要连上数据库才能看到表的索引等内容; 普遍没有做静态检查，包括go.mod文件也存在冗余的情况; …… 表面问题看着是不少，还未检查业务逻辑，不过看似混乱的项目竟然能够支撑近半年，没有出现大的问题，这不能不说是一个奇迹，我相信我的小伙伴们都尽力了，毕竟客户端兼服务端开发，这活可并不好干，业务能从0到1做起来已经相当不错。不过，我来了，就是要解决这些问题。
首先摆在我面前的问题是后端业务比较分散，几个人各写各的，既没有代码共用，服务也没有分层，因为是内部系统，也没有做权限验证，所谓分久必合，那我想到的是先将后端系统进行整合，统一入口，将鉴权补足，于是就有了API网关的想法，需求其实比较简单：
路由 鉴权 支持自定义插件 其实nginx也能满足需求，不过由于技术栈的原因，就不考虑了，搜索google得到的几大流行网关如下：
Kong: 云原生微服务网关，大名鼎鼎，看了下文档，这家伙太重了，考虑到目前我还没有操作k8s的权限, pass APISIX: 貌似是国内的团队开发，有一个web UI，看着不错的样子，不过强依赖etcd, pass traefik：新版本支持自定义插件开发，dashboard也很漂亮，不过文档看着有点吃力，尝试了一下，还是放弃了，pass KrakenD，说它是一个API网关框架其实更合适，根据文档，我快速写出自己的网关服务，自定义插件只需要实现HandlerFunc即可，非常方便快捷，配置文件虽然有点繁琐，不支持通配符，但瑕不掩瑜，一天时间我就完成了团队网关服务的雏形。 当然肯定还有其它网关我没有调研到，所谓调研也比较粗浅，文档友好，能快速开发，优先满足当前需求，解决从无到有，后续业务支撑起来，业务自然会失去技术的发展。</div><a href=/posts/api%E7%BD%91%E5%85%B3%E9%80%89%E5%9E%8B/ class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a></div></div></div></article></div><div class="relative w-100 mb4"><article class="bb b--black-10"><div class="db pv4 ph3 ph0-l no-underline dark-gray"><div class="flex flex-column flex-row-ns"><div class="blah w-100"><h1 class="f3 fw1 athelas mt0 lh-title"><a href=/posts/%E4%BF%AE%E4%BB%99/ class="color-inherit dim link">修仙</a></h1><div class="f6 f5-l lh-copy nested-copy-line-height nested-links">转眼五一假期就过去了，原本计划好的更新博文也被各种琐碎的事情打乱了，一直到今天，所谓拖延症本尊就是我了。其实想写的内容也是源自于对自己生活的记录，以后才能更容易回顾一些。
今年4月初，在阔别职场整整5个月之后，终于回归了，有兴奋，更多的是兴奋，作为一个混迹职场6年多的“老油条”，我的生物钟竟然自动调节到每天5点多就醒了，中午也不用怎么睡觉，一天精神照样很充沛，这可能就是兴奋的表象吧，亦或许是回归职场，多少带来了新鲜感，总之不说是打鸡血，斗志昂扬是配得的上的。
新公司要求每个人给自己起一个具有正面意义的花名，其实我早就想好了，花名素材来源于我看过的为数不多的修仙小说：《诛仙》与《凡人修仙传》， 这两部小说都有一个共同点：都是别人推荐我看的；我第一次看都提不起兴致；都是事隔多年后偶然一次机会看完的；都不只看了一次。
缘份就是这么奇妙，其实学习的道理也莫不如此：初学时，一头雾水；再学时，似懂非懂；还学时，窥得门径；最后终是醍醐灌顶，习得万法归宗的奥妙。这正是我喜欢《诛仙》这部小说的缘由。说起来那是十年前的事情了，彼时，初入大学，在舍友带动下，第一次接触了网络游戏《诛仙》，进而开始看原著小说。当时心思单纯，对游戏不甚感冒，小说也是提不起兴致，就这样放弃了游戏跟小说。哪知四年后在我进入研究生阶段，不知何故，机缘巧合下又想起《诛仙》这部小说，在网上搜到了电子书，这一次一发不可收拾，连看2天，愣是看完了，当时的感觉已无从得知了，只知情绪中肯定是带有兴奋的。主人公张小凡身世凄苦，像极了我们这些普通人；情路更是坎坷，年少懵懂，爱的单纯爱的深沉。平凡的人儿，想要出人头地，甚至本意并不是出人头地，终究是天意，先后修习佛、道、魔三家功法，资质平庸，却凭借心性之坚，生生闯出自己的一条修炼之路，始终没有迷失本心，这是何等的难能可贵。芸芸众生，每天有多少时间是庸庸碌碌，得过且过，工作，学习，其目的究竟是什么，还是说这目的本就是从众的，随波逐流的，想要的究竟是什么，这个疑问纠缠我好久，一直到今天，我都没有觉着找到了真正的答案，答案似乎触手可及，又似乎渐行渐远。或许是这种代入感，让我多次重读《诛仙》试图从中寻找到答案，而主角，不再是我唯一关注的人，我的注意力，移到了另一个大人物身上：万剑一。这是何等惊才绝艳啊，剑眉星目，白衣似雪，手握斩龙剑，于修炼一途，是真正的大佬，关键是人家还不藏着掖着，乐于分享，放在当下，实在是难能可贵，难怪一众师兄弟，都愿意跟随他，远赴西北蛮荒，深入魔教，虽死无憾了。在职场的这几年里，我一直想要跟随这样的人，与其共事，为其效力，颇有一种奉其为主的意思，但现实终归不是修仙，数年间，我也就遇到过一位这样的人，也正是因为跟随了这样一位大佬，我逐渐建立起自信，甚至是自负，在其身边学到的技能，受用至今，心中的感激，是无法言语的。当年我被这位大佬“选中”，据其本人所说是因为当时的我特别像是《诛仙》中一人物：田不易，看似愚钝，实则性子坚忍，内秀于心，这么说倒是也挺恰当的。
既然跟随很难，为何不成为呢？看《凡人修仙传》我记得是因为鬼脚七的推荐，初看也是乏味。在今年年初老婆坐月子期间，无聊时看的，结果又是一发不可收拾，当然，看完差不多花了半个月。主人公韩立同样是资质平庸之辈，一介凡人，偶然得知修仙一说，巧合之下，误入修仙一途，一路小心谨慎，却也遭遇不少困境，凭借谨慎的心性，超人的意志力，冲破万难，愣是在万年内，修成正果，飞升仙界。要说韩立，更接近于我们现实意义上的普通人，家境普通，资质普通，长相普通，优点是凡事三思而后行，有点小聪明，防人但不害人，像极了市井社会人，你要说他是好人，不算，坏人，也不是，他有自私的一面，有时也会展露善良，他始终以修仙为目的，步步为营，不放过任何一个可以提升修为的机会。我们这些农村来的孩子，没有强大的后盾，不正应该像他这样，方可在这偌大的城市中立足吗？现实中，却不会有那么多机会可言，往往努力，不一定会有收获，所以如今才有躺平一说，不努力也是一种选择吧，但是自己终究不是一个人，不努力，身边的亲人可怎么办？有时候觉着并不是自己有多想努力，是被什么事情推着走；有时又很想坚定的努力，搏一把，却又不知为何而搏，往后生活的尽头，很近又很远，近的是周遭泛滥的焦虑，远的是人生很长。与其期待遇到贵人，不如自己踏实前进，然而心志不受外物所扰，终究不是一件容易的事情。努力吧，或许，为了自己，也为了亲友，更为了自己一息尚存的的技术理想，还有热情，不辜负这短短几十年的人生。
花名，就叫剑一喽，要成为这样一个人，虽然，生活中能影响到的人真的非常非常有限，但是能给人带来积极的影响，哪怕是灵光一现，那该是多么美妙的事情；当然，如果能跟这样的人共事，甚至是成为朋友，那就更加绝妙了。人生或许就是一场修仙之旅吧，目前，我已筑基成功，接近假丹境界，这一路，我很平凡，但绝不平庸！</div><a href=/posts/%E4%BF%AE%E4%BB%99/ class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a></div></div></div></article></div></section><section class=w-100><h1 class=f3>More</h1><h2 class="f5 fw4 mb4 dib mr3"><a href=/posts/gomod%E4%BE%9D%E8%B5%96%E5%8C%85%E5%A4%84%E7%90%86/ class="link black dim">go mod依赖包处理</a></h2><h2 class="f5 fw4 mb4 dib mr3"><a href=/posts/%E8%AE%B0%E4%B8%80%E6%AC%A1http%E8%BF%9E%E6%8E%A5%E9%87%8D%E7%94%A8%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/ class="link black dim">记一次HTTP连接重用问题分析</a></h2><h2 class="f5 fw4 mb4 dib mr3"><a href=/posts/golang%E8%B0%83%E5%BA%A6%E5%99%A8%E7%9A%84%E4%B8%80%E4%B8%AA%E9%99%B7%E9%98%B1/ class="link black dim">golang调度器的一个陷阱</a></h2><h2 class="f5 fw4 mb4 dib mr3"><a href=/posts/%E6%95%B0%E5%AD%A6%E4%B9%8B%E7%BE%8E-diffiehellman%E5%AF%86%E9%92%A5%E4%BA%A4%E6%8D%A2/ class="link black dim">数学之美 Diffie–Hellman密钥交换</a></h2><a href=/posts/ class="link db f6 pa2 br3 bg-mid-gray white dim w4 tc">All Posts</a></section></div></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=http://example.org/>&copy; just for fun! 2021</a><div></div></div></footer></body></html>